<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LANCER Job Board - Overview</title>
  <link rel="stylesheet" href="/css/terminal.css">
  <link rel="stylesheet" href="/css/currency.css">
  <link rel="stylesheet" href="/css/client.css">
</head>
<body class="<%= colorScheme %>">
  <div class="terminal-header">
    <div class="terminal-header-left">
      <h1>> <span id="portal-heading"><%= settings.portalHeading %></span> - CLIENT INTERFACE_</h1>
      <p>> USER_GROUP: <span id="user-group"><%= settings.userGroup %></span>_</p>
      <p>> SYSTEM_STATUS: ONLINE_</p>
      <a href="/logout" class="terminal-link">[LOGOUT]</a>
    </div>
    <div class="terminal-header-right">
      <p class="terminal-info">> UNT: <span id="unt"><%= settings.unt %></span>U</p>
      <p class="terminal-info">> CURRENT_GALACTIC_POS: <span id="galactic-pos"><%= settings.currentGalacticPos %></span></p>
      <% if (!settings.openTable) { %>
      <div class="operation-progress">
        <div class="operation-progress-label">> OPERATION_PROGRESS:</div>
        <div class="progress-bar-container">
          <div class="progress-segment <%= settings.operationProgress >= 1 ? 'filled' : '' %>" id="progress-segment-1"></div>
          <div class="progress-segment <%= settings.operationProgress >= 2 ? 'filled' : '' %>" id="progress-segment-2"></div>
          <div class="progress-segment <%= settings.operationProgress >= 3 ? 'filled' : '' %>" id="progress-segment-3"></div>
        </div>
      </div>
      <% } %>
    </div>
  </div>
  
  <div class="overview-container">
    <div class="overview-grid">
      <div class="left-column">
        <div class="balance-section">
          <h2>> MANNA_BALANCE:</h2>
          <div class="balance-display" id="balance-display">
            <%= totalBalance %>
            <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
          </div>
        </div>
        
        <div class="transactions-section" id="transactions-section">
          <% if (recentTransactions.length > 0) { %>
            <h3>> RECENT_TRANSACTIONS_</h3>
            <div class="transactions-list" id="transactions-list">
              <% recentTransactions.forEach(transaction => { %>
                <div class="transaction-item">
                  <div class="transaction-main">
                    <span class="transaction-amount <%= transaction.totalAmount >= 0 ? 'positive' : 'negative' %>">
                      <%= transaction.totalAmount >= 0 ? '+' : '' %><%= transaction.totalAmount %>
                      <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
                    </span>
                    <span class="transaction-description"><%= transaction.description %></span>
                  </div>
                  <div class="transaction-details">
                    <span class="transaction-pilots">
                      Pilots: 
                      <%= transaction.relatedPilotCallsigns && transaction.relatedPilotCallsigns.length > 0
                            ? transaction.relatedPilotCallsigns.join(', ')
                            : 'None' %>
                    </span>
                    <span class="transaction-balance">
                      Balance: <%= transaction.cumulativeBalance %>
                      <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
                    </span>
                  </div>
                </div>
              <% }); %>
            </div>
            <a href="/client/finances" class="view-more-button">[VIEW_MORE]</a>
          <% } else { %>
            <h3>> RECENT_TRANSACTIONS:</h3>
            <p>> NO_TRANSACTIONS_RECORDED_</p>
            <a href="/client/finances" class="view-more-button">[VIEW_FINANCES]</a>
          <% } %>
        </div>
      </div>
      
      <div class="right-column">
        <div class="navigation-section">
          <h3>> AVAILABLE_SYSTEMS_</h3>
          <div class="nav-buttons">
            <a href="/client/jobs" class="nav-button">> JOB_BOARD</a>
            <a href="/client/base" class="nav-button">> BASE_MANAGEMENT</a>
            <a href="/client/factions" class="nav-button">> FACTION_RELATIONS</a>
            <a href="/client/pilots" class="nav-button">> PILOT_LIST</a>
            <a href="/client/procurement" class="nav-button">> SHOP</a>
            <a href="/client/reserves" class="nav-button">> RESERVES</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="/js/shared-handlers.js"></script>
  <script src="/js/sse-client.js"></script>
  <script>
    // Handle manna and pilot updates from SSE
    function handleMannaUpdate(data) {
      if (data && data.balances && data.balances.activeBalance !== undefined) {
        // Update balance display
        const balanceDisplay = document.getElementById('balance-display');
        if (balanceDisplay) {
          balanceDisplay.innerHTML = `
            ${data.balances.activeBalance}
            <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
          `;
        }
      }
    }
    
    function handlePilotsUpdate(data) {
      // Pilot updates may affect balances; update balance display if provided
      if (data && data.balances && data.balances.activeBalance !== undefined) {
        const balanceDisplay = document.getElementById('balance-display');
        if (balanceDisplay) {
          balanceDisplay.innerHTML = `
            ${data.balances.activeBalance}
            <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
          `;
        }
      }
    }
  </script>
</body>
</html>
