<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LANCER Job Board - Admin</title>
  <link rel="stylesheet" href="/css/currency.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      padding: 20px;
    }
    
    .admin-header {
      background-color: #2a2a2a;
      color: #e0e0e0;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 5px;
    }
    
    .admin-header h1 {
      margin-bottom: 10px;
    }
    
    .logout-link {
      color: #66BB6A;
      text-decoration: none;
      font-weight: bold;
    }
    
    .settings-section {
      background-color: #2a2a2a;
      padding: 30px;
      margin-bottom: 30px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .settings-section h2 {
      margin-bottom: 20px;
      color: #e0e0e0;
    }
    
    .add-job-section {
      background-color: #2a2a2a;
      padding: 30px;
      margin-bottom: 30px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .add-job-section h2 {
      margin-bottom: 20px;
      color: #e0e0e0;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #b0b0b0;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 3px;
      font-size: 14px;
      background-color: #1a1a1a;
      color: #e0e0e0;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: 2px solid #66BB6A;
      outline-offset: 1px;
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    
    .btn-primary {
      background-color: #4CAF50;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #45a049;
    }
    
    .btn-edit {
      background-color: #2196F3;
      color: white;
      margin-right: 5px;
    }
    
    .btn-edit:hover {
      background-color: #0b7dda;
    }
    
    .btn-delete {
      background-color: #f44336;
      color: white;
    }
    
    .btn-delete:hover {
      background-color: #da190b;
    }
    
    .btn-neutral {
      background-color: #6a6a6a;
      color: white;
    }
    
    .btn-neutral:hover {
      background-color: #5a5a5a;
    }
    
    .btn-neutral:focus {
      outline: 2px solid #66BB6A;
      outline-offset: 1px;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: flex-start;
      margin-top: 20px;
    }
    
    .button-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .jobs-list {
      background-color: #2a2a2a;
      padding: 30px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .jobs-list h2 {
      margin-bottom: 20px;
      color: #e0e0e0;
    }
    
    .job-item {
      border: 1px solid #444;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 3px;
      background-color: #1a1a1a;
    }
    
    .job-item h3 {
      color: #e0e0e0;
      margin-bottom: 10px;
    }
    
    .job-item-field {
      margin-bottom: 8px;
      color: #b0b0b0;
    }
    
    .job-item-field strong {
      color: #e0e0e0;
    }
    
    .job-item-actions {
      margin-top: 15px;
    }
    
    .rank-display {
      color: #FFD700;
      font-size: 18px;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    
    .modal-content {
      background-color: #2a2a2a;
      margin: 5% auto;
      padding: 30px;
      border-radius: 5px;
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h2 {
      color: #e0e0e0;
    }
    
    .close {
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #b0b0b0;
    }
    
    .close:hover {
      color: #e0e0e0;
    }
    
    .emblem-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #444;
      padding: 10px;
      border-radius: 3px;
      background-color: #ffffff;
    }
    
    .emblem-option {
      position: relative;
      padding: 8px;
      border: 2px solid transparent;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s ease;
      background-color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 80px;
    }
    
    .emblem-option:hover {
      border-color: #66BB6A;
      box-shadow: 0 2px 5px rgba(102,187,106,0.3);
    }
    
    .emblem-option.selected {
      border-color: #66BB6A;
      background-color: #e8f5e9;
      box-shadow: 0 2px 8px rgba(102, 187, 106, 0.5);
    }
    
    .emblem-option img {
      max-width: 100%;
      max-height: 60px;
      display: block;
    }
    
    .emblem-option.none {
      font-size: 12px;
      color: #666;
      font-weight: bold;
      text-align: center;
    }
    
    .notification-footer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 15px 25px;
      border-radius: 5px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      z-index: 2000;
      pointer-events: none;
    }
    
    .notification-footer.show {
      opacity: 1;
    }
    
    .emblem-display {
      max-width: 150px;
      max-height: 150px;
      margin-top: 10px;
      border: 1px solid #ddd;
      padding: 10px;
      background-color: white;
      border-radius: 3px;
    }

    .form-inline {
      display: inline;
    }

    .is-hidden {
      display: none;
    }

    .helper-text {
      font-size: 0.9em;
      color: #e0e0e0;
    }

    .btn-add-job {
      margin-top: 25px;
      padding: 15px 30px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
    }
  </style>
</head>
<body>
  <div class="admin-header">
    <h1>LANCER Job Board - Admin Panel</h1>
    <p>Manage job postings and global settings</p>
    <a href="/" class="logout-link">Logout</a>
  </div>

  <div class="settings-section">
    <h2>Global Settings</h2>
    <form id="settingsForm">
      <div class="form-group">
        <label for="settingsColorScheme">Color Scheme (Client & Landing View)</label>
        <select id="settingsColorScheme" name="colorScheme" required>
          <option value="grey" <%= settings.colorScheme === 'grey' ? 'selected' : '' %>>Grey (Black & White)</option>
          <option value="orange" <%= settings.colorScheme === 'orange' ? 'selected' : '' %>>Orange (Portal Style)</option>
          <option value="green" <%= settings.colorScheme === 'green' ? 'selected' : '' %>>Green (Classic Terminal)</option>
          <option value="blue" <%= settings.colorScheme === 'blue' ? 'selected' : '' %>>Blue (Dark Blue Background)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="settingsUnt">UNT (Date - DD/MM/YYYY)</label>
        <input type="text" id="settingsUnt" name="unt" value="<%= settings.unt %>" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}" required>
      </div>
      
      <div class="form-group">
        <label for="settingsGalacticPos">Current Galactic Position</label>
        <input type="text" id="settingsGalacticPos" name="currentGalacticPos" value="<%= settings.currentGalacticPos %>" required>
      </div>
      
      <div class="form-group">
        <label for="settingsUserGroup">User Group</label>
        <input type="text" id="settingsUserGroup" name="userGroup" value="<%= settings.userGroup %>" maxlength="100" required>
      </div>
      
      <button type="submit" class="btn btn-primary">Save Settings</button>
    </form>
  </div>

  <div class="add-job-section">
    <h2>Add New Job</h2>
    <form id="addJobForm">
      <div class="form-group">
        <label for="jobName">Job Name</label>
        <input type="text" id="jobName" name="name" required>
      </div>
      
      <div class="form-group">
        <label for="jobRank">Job Rank (1-3 stars)</label>
        <select id="jobRank" name="rank" required>
          <option value="1">1 Star</option>
          <option value="2">2 Stars</option>
          <option value="3">3 Stars</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="jobClient">Client</label>
        <input type="text" id="jobClient" name="client" required>
      </div>
      
      <div class="form-group">
        <label for="jobType">Job Type</label>
        <input type="text" id="jobType" name="jobType" required>
      </div>
      
      <div class="form-group">
        <label for="jobDescription">Objective</label>
        <textarea id="jobDescription" name="description" required></textarea>
      </div>
      
      <div class="form-group">
        <label for="jobClientBrief">Client Brief</label>
        <textarea id="jobClientBrief" name="clientBrief" required></textarea>
      </div>
      
      <div class="form-group">
        <label for="jobCurrencyPay" class="currency-label">
          Currency Pay (e.g., 100m)
          <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
        </label>
        <input type="text" id="jobCurrencyPay" name="currencyPay" required>
      </div>
      
      <div class="form-group">
        <label for="jobAdditionalPay">Additional Pay</label>
        <input type="text" id="jobAdditionalPay" name="additionalPay">
      </div>
      
      <div class="form-group">
        <label for="jobEmblem">Emblem</label>
        <input type="hidden" id="jobEmblem" name="emblem" value="">
        <div class="emblem-grid" id="emblemGrid">
          <div class="emblem-option none" data-emblem="">
            [None]
          </div>
          <% emblems.forEach(emblem => { %>
            <div class="emblem-option" data-emblem="<%= emblem %>" title="<%= formatEmblemTitle(emblem) %>">
              <img src="/emblems/<%= emblem %>" alt="<%= formatEmblemTitle(emblem) %>">
            </div>
          <% }); %>
        </div>
      </div>
    </form>
	
<div class="button-group">
  <div class="button-container">
    <form id="uploadForm" class="form-inline" enctype="multipart/form-data">
      <input type="file" id="fileInput" class="is-hidden" name="myFile" accept="image/png,image/jpeg,image/bmp">
      <button type="button" class="btn btn-neutral"
        onclick="document.getElementById('fileInput').click();"
        title="Uploads an image and converts it to SVG">
        Upload Emblem
      </button>
    </form>
    <p class="helper-text">Accepts PNG, JPEG, BMP (max 10MB)</p>
  </div>
  
  <div class="button-container">
    <button type="button" class="btn btn-delete" id="deleteEmblemBtn" onclick="deleteSelectedEmblem()"
      title="Deletes the currently selected emblem (if not in use by any jobs)">
      Delete Selected Emblem
    </button>
    <p class="helper-text">Deletes the selected emblem if not in use</p>
  </div>
</div>

<button type="submit" class="btn btn-primary btn-add-job" form="addJobForm">Add Job</button>
	
  </div>

  <div class="jobs-list">
    <h2>Existing Jobs</h2>
    <div id="jobsList">
      <% jobs.forEach(job => { %>
        <div class="job-item" data-id="<%= job.id %>">
          <h3><%= job.name %></h3>
          <div class="job-item-field">
            <strong>Rank:</strong> 
            <span class="rank-display">
              <% for(let i = 0; i < job.rank; i++) { %>★<% } %>
              <% for(let i = job.rank; i < 3; i++) { %>☆<% } %>
            </span>
          </div>
          <div class="job-item-field"><strong>Client:</strong> <%= job.client %></div>
          <div class="job-item-field"><strong>Job Type:</strong> <%= job.jobType %></div>
          <div class="job-item-field"><strong>Objective:</strong> <%= job.description %></div>
          <div class="job-item-field"><strong>Client Brief:</strong> <%= job.clientBrief %></div>
          <div class="job-item-field"><strong>Payment:</strong>
            <%= job.currencyPay %>
            <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
          </div>
          <% if (job.additionalPay) { %>
            <div class="job-item-field"><strong>Additional Pay:</strong> <%= job.additionalPay %></div>
          <% } %>
          <% if (job.emblem) { %>
            <div class="job-item-field">
              <strong>Emblem:</strong> <%= job.emblem %>
              <br>
              <img src="/emblems/<%= job.emblem %>" alt="<%= job.emblem.replace('.svg', '') %>" class="emblem-display">
            </div>
          <% } %>
          <div class="job-item-actions">
            <button class="btn btn-edit" onclick="editJob('<%= job.id %>')">Edit</button>
            <button class="btn btn-delete" onclick="deleteJob('<%= job.id %>')">Delete</button>
          </div>
        </div>
      <% }); %>
    </div>
  </div>

  <!-- Notification Footer -->
  <div id="notificationFooter" class="notification-footer"></div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Job</h2>
        <span class="close" onclick="closeEditModal()">&times;</span>
      </div>
      <form id="editJobForm">
        <input type="hidden" id="editJobId">
        <div class="form-group">
          <label for="editJobName">Job Name</label>
          <input type="text" id="editJobName" name="name" required>
        </div>
        
        <div class="form-group">
          <label for="editJobRank">Job Rank (1-3 stars)</label>
          <select id="editJobRank" name="rank" required>
            <option value="1">1 Star</option>
            <option value="2">2 Stars</option>
            <option value="3">3 Stars</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="editJobClient">Client</label>
          <input type="text" id="editJobClient" name="client" required>
        </div>
        
        <div class="form-group">
          <label for="editJobType">Job Type</label>
          <input type="text" id="editJobType" name="jobType" required>
        </div>
        
        <div class="form-group">
          <label for="editJobDescription">Objective</label>
          <textarea id="editJobDescription" name="description" required></textarea>
        </div>
        
        <div class="form-group">
          <label for="editJobClientBrief">Client Brief</label>
          <textarea id="editJobClientBrief" name="clientBrief" required></textarea>
        </div>
        
        <div class="form-group">
          <label for="editJobCurrencyPay" class="currency-label">
            Currency Pay (e.g., 100m)
            <img src="/css/images/manna_symbol.svg" alt="Currency Icon" class="currency-icon">
          </label>
          <input type="text" id="editJobCurrencyPay" name="currencyPay" required>
        </div>

        <div class="form-group">
          <label for="editJobAdditionalPay">Additional Pay</label>
          <input type="text" id="editJobAdditionalPay" name="additionalPay">
        </div>
        
        <div class="form-group">
          <label for="editJobEmblem">Emblem</label>
          <input type="hidden" id="editJobEmblem" name="emblem" value="">
          <div class="emblem-grid" id="editEmblemGrid">
            <div class="emblem-option none" data-emblem="">
              [None]
            </div>
            <% emblems.forEach(emblem => { %>
              <div class="emblem-option" data-emblem="<%= emblem %>" title="<%= formatEmblemTitle(emblem) %>">
                <img src="/emblems/<%= emblem %>" alt="<%= formatEmblemTitle(emblem) %>">
              </div>
            <% }); %>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </form>
    </div>
  </div>

  <script>
    // Helper function to format emblem filename for display
    function formatEmblemTitle(filename) {
      return filename.replace('.svg', '').replace(/_/g, ' ');
    }

    // Settings form submission
    document.getElementById('settingsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      
      // Client-side date validation
      const datePattern = /^\d{2}\/\d{2}\/\d{4}$/;
      if (data.unt && !datePattern.test(data.unt)) {
        alert('Invalid date format. Please use DD/MM/YYYY');
        return;
      }
      
      if (data.unt && datePattern.test(data.unt)) {
        const [day, month, year] = data.unt.split('/').map(Number);
        if (month < 1 || month > 12 || day < 1) {
          alert('Invalid date values. Day must be at least 1, month must be 1-12');
          return;
        }
        
        // Check days per month
        const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        // Check for leap year
        const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        if (month === 2 && isLeapYear) {
          daysInMonth[1] = 29;
        }
        
        if (day > daysInMonth[month - 1]) {
          alert(`Invalid day for month ${month}. Maximum is ${daysInMonth[month - 1]} days.`);
          return;
        }
      }
      
      try {
        const response = await fetch('/api/settings', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showNotification('Settings saved successfully!');
        } else {
          const errorData = await response.json();
          alert(errorData.message || 'Failed to save settings');
        }
      } catch (error) {
        alert('Error saving settings');
      }
    });

    // Emblem selection handling
    function setupEmblemGrid(gridId, inputId) {
      const grid = document.getElementById(gridId);
      const input = document.getElementById(inputId);
      
      grid.addEventListener('click', (e) => {
        const option = e.target.closest('.emblem-option');
        if (!option) {
          e.stopPropagation();
          return;
        }
        
        // Remove selected class from all options in this grid
        grid.querySelectorAll('.emblem-option').forEach(opt => opt.classList.remove('selected'));
        
        // Add selected class to clicked option
        option.classList.add('selected');
        
        // Update hidden input
        input.value = option.getAttribute('data-emblem');
      });
    }
    
    // Initialize emblem grids
    setupEmblemGrid('emblemGrid', 'jobEmblem');
    setupEmblemGrid('editEmblemGrid', 'editJobEmblem');
    
    // Store notification timeout ID
    let notificationTimeoutId = null;

    // Show notification
    function showNotification(message) {
      const notification = document.getElementById('notificationFooter');
      notification.textContent = message;
      notification.classList.add('show');
      
      // Clear any existing timeout to prevent race conditions
      if (notificationTimeoutId) {
        clearTimeout(notificationTimeoutId);
      }
      notificationTimeoutId = setTimeout(() => {
        notification.classList.remove('show');
        notificationTimeoutId = null;
      }, 3000);
    }

    function upsertEmblemOption(gridEl, emblemFilename) {
      const options = Array.from(gridEl.querySelectorAll('.emblem-option'));
      let option = options.find(o => o.getAttribute('data-emblem') === emblemFilename);

      const title = formatEmblemTitle(emblemFilename);
      const src = `/emblems/${encodeURIComponent(emblemFilename)}?v=${Date.now()}`;

      if (!option) {
        option = document.createElement('div');
        option.className = 'emblem-option';
        option.setAttribute('data-emblem', emblemFilename);
        option.title = title;

        const img = document.createElement('img');
        img.alt = title;
        img.src = src;
        option.appendChild(img);

        gridEl.appendChild(option);
      } else {
        option.title = title;
        const img = option.querySelector('img');
        if (img) img.src = src;
      }

      return option;
    }

    document.getElementById('fileInput').addEventListener('change', async function () {
      if (!this.files || this.files.length === 0) return;

      const filePayload = new FormData();
      filePayload.append('myFile', this.files[0]);

      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: filePayload
        });

        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          console.error('Failed to parse JSON response:', jsonError);
          alert('Server returned an invalid response. Please try again or contact support.');
          return;
        }
        if (!response.ok) {
          alert((data && data.message) || 'Upload failed');
          return;
        }

        const emblem = data.emblem;
        const addGrid = document.getElementById('emblemGrid');
        const editGrid = document.getElementById('editEmblemGrid');

        const addOption = upsertEmblemOption(addGrid, emblem);
        upsertEmblemOption(editGrid, emblem);

        addGrid.querySelectorAll('.emblem-option').forEach(o => o.classList.remove('selected'));
        addOption.classList.add('selected');
        document.getElementById('jobEmblem').value = emblem;

        showNotification(`Emblem uploaded: ${emblem}`);
      } catch (error) {
        alert('Network error during upload: ' + error.message);
      } finally {
        this.value = '';
      }
    });

    // Add job
    document.getElementById('addJobForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      
      try {
        const response = await fetch('/api/jobs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showNotification('Job added successfully!');
          setTimeout(() => location.reload(), 3000);
        }
      } catch (error) {
        alert('Error adding job');
      }
    });

    // Edit job
    function editJob(id) {
      const jobItem = document.querySelector(`.job-item[data-id="${id}"]`);
      const jobData = <%- JSON.stringify(jobs) %>.find(j => j.id === id);
      
      document.getElementById('editJobId').value = jobData.id;
      document.getElementById('editJobName').value = jobData.name;
      document.getElementById('editJobRank').value = jobData.rank;
      document.getElementById('editJobClient').value = jobData.client;
      document.getElementById('editJobType').value = jobData.jobType;
      document.getElementById('editJobDescription').value = jobData.description;
      document.getElementById('editJobClientBrief').value = jobData.clientBrief;
      document.getElementById('editJobCurrencyPay').value = jobData.currencyPay;
      document.getElementById('editJobAdditionalPay').value = jobData.additionalPay || '';
      document.getElementById('editJobEmblem').value = jobData.emblem || '';
      
      // Select the correct emblem in the grid
      const editGrid = document.getElementById('editEmblemGrid');
      editGrid.querySelectorAll('.emblem-option').forEach(opt => opt.classList.remove('selected'));
      const selectedEmblem = Array.from(editGrid.querySelectorAll('.emblem-option')).find(opt => opt.getAttribute('data-emblem') === (jobData.emblem || ''));
      if (selectedEmblem) {
        selectedEmblem.classList.add('selected');
      }
      
      document.getElementById('editModal').style.display = 'block';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    document.getElementById('editJobForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      const id = document.getElementById('editJobId').value;
      
      try {
        const response = await fetch(`/api/jobs/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showNotification('Changes successfully saved');
          closeEditModal();
          setTimeout(() => location.reload(), 3000);
        } else {
          let errorMsg = 'Failed to update job';
          try {
            const errorData = await response.json();
            if (errorData && errorData.message) {
              errorMsg += ': ' + errorData.message;
            }
          } catch (e) {
            // ignore JSON parse errors
          }
          showNotification(errorMsg);
        }
      } catch (error) {
        alert('Error updating job');
      }
    });

    // Delete job
    async function deleteJob(id) {
      if (confirm('Are you sure you want to delete this job?')) {
        try {
          const response = await fetch(`/api/jobs/${id}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            alert('Job deleted successfully!');
            location.reload();
          }
        } catch (error) {
          alert('Error deleting job');
        }
      }
    }

    // Delete selected emblem
    async function deleteSelectedEmblem() {
      const selectedEmblem = document.getElementById('jobEmblem').value;
      
      if (!selectedEmblem) {
        alert('Please select an emblem to delete');
        return;
      }
      
      if (confirm(`Are you sure you want to delete the emblem "${formatEmblemTitle(selectedEmblem)}"?\n\nThis action cannot be undone.`)) {
        try {
          const response = await fetch(`/api/emblems/${encodeURIComponent(selectedEmblem)}`, {
            method: 'DELETE'
          });
          
          const data = await response.json();
          
          if (response.ok) {
            showNotification('Emblem deleted successfully!');
            setTimeout(() => location.reload(), 3000);
          } else {
            alert(data.message || 'Failed to delete emblem');
          }
        } catch (error) {
          alert('Error deleting emblem: ' + error.message);
        }
      }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('editModal');
      if (event.target === modal) {
        closeEditModal();
      }
    }
  </script>
</body>
</html>
